### FRONTEND: index.html
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tr·ª£ l√≠ Y t·∫ø</title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, Noto Sans; }
    .scrollbar-thin { scrollbar-width: thin; }
    .scrollbar-thin::-webkit-scrollbar { width: 8px; height: 8px; }
    .scrollbar-thin::-webkit-scrollbar-thumb { border-radius: 8px; background: #cbd5e1; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900 dark:bg-slate-900 dark:text-slate-100 min-h-screen">
<div class="max-w-5xl mx-auto p-4 sm:p-6">
  <!-- Header -->
  <header class="flex items-center justify-between gap-4 mb-4">
    <h1 class="text-2xl sm:text-3xl font-bold">Tr·ª£ l√≠ Y t·∫ø</h1>
    <div class="flex items-center gap-2">
      <input id="username" type="text" placeholder="T√™n c·ªßa b·∫°n" class="px-3 py-2 rounded-xl bg-white/80 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 focus:outline-none focus:ring focus:ring-indigo-500/30" />
      <button id="saveNameBtn" class="px-3 py-2 rounded-xl bg-indigo-600 text-white font-medium hover:bg-indigo-500">L∆∞u t√™n</button>
    </div>
  </header>

  <!-- Main -->
  <div class="grid md:grid-cols-3 gap-4">
    <section class="md:col-span-2 bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 flex flex-col h-[72vh]">
      <div id="chatHistory" class="flex-1 overflow-y-auto p-4 space-y-3 scrollbar-thin"></div>
      <div class="border-t border-slate-100 dark:border-slate-700 p-3">
        <div class="flex gap-2 items-end">
          <textarea id="userInput" rows="2" placeholder="B·∫°n mu·ªën h·ªèi g√¨?" class="flex-1 resize-none px-3 py-2 rounded-2xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 focus:outline-none focus:ring focus:ring-indigo-500/30"></textarea>
          <button id="sendBtn" class="px-4 py-2 rounded-2xl bg-indigo-600 text-white font-semibold hover:bg-indigo-500">G·ª≠i</button>
          <button id="voiceBtn" class="px-4 py-2 rounded-2xl bg-emerald-600 text-white hover:bg-emerald-500">üé§</button>
          <div class="relative">
            <button id="attachBtn" class="px-4 py-2 rounded-2xl bg-slate-200 dark:bg-slate-700 hover:bg-slate-300">+</button>
            <div id="fileMenu" class="hidden absolute bottom-10 left-0 bg-white dark:bg-slate-800 border rounded shadow-lg p-2 space-y-2">
              <input type="file" id="fileInput" accept="image/*,.pdf,.doc,.docx,.txt" />
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Appointments -->
    <aside class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 p-4 space-y-4 h-[72vh] overflow-y-auto scrollbar-thin">
      <div>
        <h2 class="font-semibold text-lg mb-2">L·ªãch h·∫πn c·ªßa t√¥i</h2>
        <button id="refreshApptBtn" class="px-3 py-1.5 rounded-xl bg-slate-100 dark:bg-slate-700 mb-2">T·∫£i l·ªãch</button>
        <ul id="apptList" class="space-y-2"></ul>
      </div>
      <hr class="border-slate-200 dark:border-slate-700" />
      <form id="bookForm" class="space-y-3">
        <div><label>Ph√≤ng kh√°m</label><input id="clinic" required class="w-full px-3 py-2 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700"></div>
        <div class="grid grid-cols-2 gap-3">
          <div><label>Ng√†y kh√°m</label><input type="date" id="date" required class="w-full p-2 border rounded"></div>
          <div><label>Gi·ªù kh√°m</label><input type="time" id="time" required class="w-full p-2 border rounded"></div>
        </div>
        <button type="submit" class="w-full px-3 py-2 rounded-xl bg-emerald-600 text-white font-semibold hover:bg-emerald-500">ƒê·∫∑t l·ªãch</button>
      </form>
    </aside>
  </div>
</div>

<script>
const API_BASE = "https://trolyyte.onrender.com";
const chatHistory = document.getElementById('chatHistory');
const userInput = document.getElementById('userInput');
const sendBtn = document.getElementById('sendBtn');
const usernameEl = document.getElementById('username');
const saveNameBtn = document.getElementById('saveNameBtn');
const refreshApptBtn = document.getElementById('refreshApptBtn');
const apptList = document.getElementById('apptList');
const clinicEl = document.getElementById('clinic');
const dateEl = document.getElementById('date');
const timeEl = document.getElementById('time');
const bookForm = document.getElementById('bookForm');
const voiceBtn = document.getElementById('voiceBtn');
const attachBtn = document.getElementById('attachBtn');
const fileMenu = document.getElementById('fileMenu');
const fileInput = document.getElementById('fileInput');

// Toggle file menu
attachBtn.addEventListener('click', ()=>{ fileMenu.classList.toggle('hidden'); });

// Save/load username
const persistedName = localStorage.getItem('health_username');
if(persistedName) usernameEl.value = persistedName;
saveNameBtn.addEventListener('click', ()=>{ localStorage.setItem('health_username', usernameEl.value.trim()); });

// Chat functions
function addMsg(role,text){
  const wrap = document.createElement('div');
  wrap.className = `flex ${role==='user'?'justify-end':'justify-start'}`;
  const bubble = document.createElement('div');
  bubble.className = `max-w-[85%] px-3 py-2 rounded-2xl shadow-sm border text-sm whitespace-pre-wrap ${role==='user'?'bg-indigo-600 text-white border-indigo-500':'bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-700'}`;
  bubble.innerHTML = marked.parse(text);
  wrap.appendChild(bubble);
  chatHistory.appendChild(wrap);
  chatHistory.scrollTop = chatHistory.scrollHeight;
}

async function sendMessage(){
  const name=usernameEl.value.trim(), msg=userInput.value.trim();
  if(!name||!msg)return;
  addMsg('user',msg); userInput.value='';
  try{
    const res=await fetch(`${API_BASE}/api/message`,{
      method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({username:name,message:msg})
    });
    const data=await res.json();
    addMsg('assistant',data.reply||'');
  }catch(e){ addMsg('assistant','L·ªói khi g·ªçi backend'); }
}
sendBtn.addEventListener('click',sendMessage);
userInput.addEventListener('keydown', e=>{ if(e.key==='Enter'&&(e.ctrlKey||e.metaKey)) sendMessage(); });

// Voice chat
voiceBtn.addEventListener('click',async()=>{
  const name=usernameEl.value.trim();
  if(!name)return alert('Nh·∫≠p t√™n tr∆∞·ªõc');
  const stream = await navigator.mediaDevices.getUserMedia({audio:true});
  const mediaRecorder = new MediaRecorder(stream);
  let chunks=[];
  mediaRecorder.ondataavailable = e => chunks.push(e.data);
  mediaRecorder.start();
  voiceBtn.textContent='‚ñ†';
  mediaRecorder.onstop=async()=>{
    const blob = new Blob(chunks,{type:'audio/webm'});
    const formData = new FormData();
    formData.append('username',name);
    formData.append('file',blob,'voice.webm');
    const res = await fetch(`${API_BASE}/api/voice`,{method:'POST',body:formData});
    const data = await res.json();
    addMsg('assistant',data.reply||'');
    voiceBtn.textContent='üé§';
  };
  setTimeout(()=>mediaRecorder.stop(),5000); // 5s ghi √¢m
});

// File upload
fileInput.addEventListener('change',async()=>{
  const name=usernameEl.value.trim();
  if(!name)return alert('Nh·∫≠p t√™n tr∆∞·ªõc');
  const file=fileInput.files[0];
  if(!file)return;
  const formData=new FormData();
  formData.append('username',name);
  formData.append('file',file);
  formData.append('message',userInput.value.trim());
  const res=await fetch(`${API_BASE}/api/message-with-file`,{method:'POST',body:formData});
  const data=await res.json();
  addMsg('assistant',data.reply||'');
  fileInput.value='';
  fileMenu.classList.add('hidden');
});
</script>
</body>
</html>
